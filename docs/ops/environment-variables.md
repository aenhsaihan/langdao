# Environment Variables Reference

Complete reference for all environment variables used across the LangDAO platform.

---

## Backend (Express + Socket.io)

**Location:** `backend/.env`

### Server Configuration

| Variable | Required | Default | Description |
|----------|----------|---------|-------------|
| `PORT` | No | `4000` | Port for backend server |
| `NODE_ENV` | No | `development` | Environment mode (`development`, `production`, `test`) |
| `CORS_ORIGIN` | No | `http://localhost:3000` | Allowed CORS origin for frontend |

### Blockchain Configuration

| Variable | Required | Default | Description |
|----------|----------|---------|-------------|
| `RPC_URL` | Yes | `http://localhost:8545` | Ethereum RPC endpoint (local Hardhat or testnet) |
| `CONTRACT_ADDRESS` | Yes | - | Deployed LangDAO contract address |
| `BACKEND_PRIVATE_KEY` | Yes | - | Private key for backend wallet (to call `endSession()`) |

⚠️ **Security Warning:** Never commit private keys to git. Use environment variables or secrets management in production.

### Redis Configuration

| Variable | Required | Default | Description |
|----------|----------|---------|-------------|
| `REDIS_URL` | No | `redis://localhost:6379` | Redis connection URL |

**Redis is used for:**
- Tutor availability state
- Student request storage
- Session mappings
- Socket-to-address bindings
- Rate limiting

### Example `.env`

```bash
# Server
PORT=4000
NODE_ENV=development
CORS_ORIGIN=http://localhost:3000

# Blockchain
RPC_URL=http://localhost:8545
CONTRACT_ADDRESS=0x5FbDB2315678afecb367f032d93F642f64180aa3
BACKEND_PRIVATE_KEY=0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80

# Redis
REDIS_URL=redis://localhost:6379
```

---

## Frontend (Next.js)

**Location:** `webapp/packages/nextjs/.env.local`

### Thirdweb Configuration

| Variable | Required | Default | Description |
|----------|----------|---------|-------------|
| `NEXT_PUBLIC_THIRDWEB_CLIENT_ID` | Yes | - | Thirdweb client ID for wallet connection |

Get your client ID from: https://thirdweb.com/dashboard

### Alchemy Configuration

| Variable | Required | Default | Description |
|----------|----------|---------|-------------|
| `NEXT_PUBLIC_ALCHEMY_API_KEY` | Yes | - | Alchemy API key for RPC access |

Get your API key from: https://dashboard.alchemy.com/

### WalletConnect Configuration

| Variable | Required | Default | Description |
|----------|----------|---------|-------------|
| `NEXT_PUBLIC_WALLET_CONNECT_PROJECT_ID` | Yes | - | WalletConnect project ID |

Get your project ID from: https://cloud.walletconnect.com/

### Socket.io Configuration

| Variable | Required | Default | Description |
|----------|----------|---------|-------------|
| `NEXT_PUBLIC_SOCKET_URL` | No | `http://localhost:4000` | Backend Socket.io server URL |

### WebRTC Configuration

| Variable | Required | Default | Description |
|----------|----------|---------|-------------|
| `NEXT_PUBLIC_WEBRTC_URL` | No | `http://localhost:3000` | WebRTC server URL |

### Example `.env.local`

```bash
# Thirdweb
NEXT_PUBLIC_THIRDWEB_CLIENT_ID=your_client_id_here

# Alchemy
NEXT_PUBLIC_ALCHEMY_API_KEY=your_alchemy_api_key

# WalletConnect
NEXT_PUBLIC_WALLET_CONNECT_PROJECT_ID=your_project_id

# Backend
NEXT_PUBLIC_SOCKET_URL=http://localhost:4000

# WebRTC
NEXT_PUBLIC_WEBRTC_URL=http://localhost:3000
```

---

## Smart Contracts (Hardhat)

**Location:** `webapp/packages/hardhat/.env`

### Alchemy Configuration

| Variable | Required | Default | Description |
|----------|----------|---------|-------------|
| `ALCHEMY_API_KEY` | No | - | Alchemy API key for testnet deployment |

### Etherscan Configuration

| Variable | Required | Default | Description |
|----------|----------|---------|-------------|
| `ETHERSCAN_V2_API_KEY` | No | - | Etherscan API key for contract verification |

Get your API key from: https://etherscan.io/myapikey

### Deployer Configuration

| Variable | Required | Default | Description |
|----------|----------|---------|-------------|
| `DEPLOYER_PRIVATE_KEY_ENCRYPTED` | No | - | Encrypted deployer private key (generated by Scaffold-ETH) |

⚠️ **Don't fill this manually!** Use:
- `yarn generate` - Generate new account
- `yarn account:import` - Import existing private key

### Example `.env`

```bash
# Alchemy (for testnet deployment)
ALCHEMY_API_KEY=your_alchemy_api_key

# Etherscan (for contract verification)
ETHERSCAN_V2_API_KEY=your_etherscan_api_key

# Deployer (generated by yarn generate)
DEPLOYER_PRIVATE_KEY_ENCRYPTED=...encrypted_key...
```

---

## WebRTC Server

**Location:** `backend/webRTC-implementation-LangDAO/` (no .env file, uses environment variables)

### Server Configuration

| Variable | Required | Default | Description |
|----------|----------|---------|-------------|
| `PORT` | No | `3000` | Port for WebRTC server |
| `BACKEND_URL` | No | `http://localhost:4000/api/webrtc-events` | Backend API endpoint for session events |

### Example (set in shell or process manager)

```bash
PORT=3000
BACKEND_URL=http://localhost:4000/api/webrtc-events
```

---

## Environment-Specific Configurations

### Development (Local)

```bash
# Backend
PORT=4000
NODE_ENV=development
RPC_URL=http://localhost:8545
REDIS_URL=redis://localhost:6379

# Frontend
NEXT_PUBLIC_SOCKET_URL=http://localhost:4000
NEXT_PUBLIC_WEBRTC_URL=http://localhost:3000

# WebRTC
PORT=3000
BACKEND_URL=http://localhost:4000/api/webrtc-events
```

### Production (Testnet)

```bash
# Backend
PORT=4000
NODE_ENV=production
RPC_URL=https://eth-sepolia.g.alchemy.com/v2/YOUR_KEY
REDIS_URL=redis://your-redis-cloud-url:6379
CORS_ORIGIN=https://your-frontend.vercel.app

# Frontend
NEXT_PUBLIC_SOCKET_URL=https://your-backend.railway.app
NEXT_PUBLIC_WEBRTC_URL=https://your-webrtc.railway.app
NEXT_PUBLIC_ALCHEMY_API_KEY=your_alchemy_api_key

# WebRTC
PORT=3000
BACKEND_URL=https://your-backend.railway.app/api/webrtc-events
```

---

## Security Best Practices

### Never Commit These to Git

- ❌ Private keys (`BACKEND_PRIVATE_KEY`, `DEPLOYER_PRIVATE_KEY`)
- ❌ API keys (`ALCHEMY_API_KEY`, `ETHERSCAN_API_KEY`)
- ❌ Client IDs (`THIRDWEB_CLIENT_ID`, `WALLET_CONNECT_PROJECT_ID`)
- ❌ Production Redis URLs with credentials

### Use `.gitignore`

Ensure these are in `.gitignore`:
```
.env
.env.local
.env.*.local
```

### Production Secrets Management

For production, use:
- **Vercel:** Environment Variables in project settings
- **Railway:** Environment Variables in service settings
- **Render:** Environment Variables in service settings
- **AWS:** AWS Secrets Manager
- **GCP:** Secret Manager
- **Azure:** Key Vault

### Rotate Keys Regularly

- Rotate API keys every 90 days
- Never reuse private keys across environments
- Use different keys for dev/staging/production

---

## Troubleshooting

### Backend Can't Connect to Redis

**Error:** `Redis connection failed`

**Solution:**
1. Check Redis is running: `redis-cli ping`
2. Verify `REDIS_URL` is correct
3. Check firewall/network settings

### Frontend Can't Connect to Backend

**Error:** `Socket.io connection failed`

**Solution:**
1. Check `NEXT_PUBLIC_SOCKET_URL` matches backend URL
2. Verify CORS settings in backend
3. Check backend is running: `curl http://localhost:4000/health`

### Smart Contract Deployment Fails

**Error:** `Insufficient funds` or `Invalid API key`

**Solution:**
1. Check `ALCHEMY_API_KEY` is valid
2. Ensure deployer wallet has testnet ETH
3. Verify network configuration in `hardhat.config.ts`

### WebRTC Server Can't Notify Backend

**Error:** `Backend notification failed`

**Solution:**
1. Check `BACKEND_URL` is correct
2. Verify backend is running and accessible
3. Check network/firewall settings

---

## Quick Setup Guide

### 1. Clone Repository

```bash
git clone https://github.com/aenhsaihan/langdao-ethonline2025.git
cd langdao-ethonline2025
```

### 2. Install Node Version

```bash
nvm use
```

### 3. Set Up Backend

```bash
cd backend
cp .env.example .env
# Edit .env with your values
npm install
```

### 4. Set Up Frontend

```bash
cd webapp
npm install --legacy-peer-deps

cd packages/nextjs
cp .env.example .env.local
# Edit .env.local with your API keys
```

### 5. Set Up Smart Contracts

```bash
cd webapp/packages/hardhat
cp .env.example .env
yarn generate  # Generate deployer account
```

### 6. Start Services

```bash
# Terminal 1: Local blockchain
cd webapp/packages/hardhat
yarn chain

# Terminal 2: Deploy contracts
cd webapp/packages/hardhat
yarn deploy

# Terminal 3: Redis
redis-server

# Terminal 4: Backend
cd backend
npm run dev

# Terminal 5: WebRTC
cd backend/webRTC-implementation-LangDAO
npm start

# Terminal 6: Frontend
cd webapp
yarn start
```

---

## Environment Variables Checklist

### Before Development

- [ ] Backend `.env` created and configured
- [ ] Frontend `.env.local` created with API keys
- [ ] Hardhat `.env` created (or use `yarn generate`)
- [ ] Redis running locally
- [ ] All API keys obtained (Alchemy, WalletConnect, Thirdweb)

### Before Deployment

- [ ] Production environment variables set in hosting platform
- [ ] Private keys stored securely (not in code)
- [ ] API keys rotated for production
- [ ] CORS origins updated for production URLs
- [ ] Redis URL updated for production instance
- [ ] Contract addresses updated for deployed contracts

---

## Related Documentation

- [Architecture Overview](../architecture/overview.md) - System architecture
- [Socket Events Reference](../tech/socket-events.md) - Socket.io events
- [Deployment Guide](deployment.md) - Production deployment (coming soon)

---

**Last Updated:** November 10, 2025
